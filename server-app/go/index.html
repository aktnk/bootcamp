<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IIJ Bootcamp</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Go言語を使って簡単なWebアプリケーションを作ります">
    
    <link rel="preload" href="/bootcamp/assets/css/0.styles.c27c388f.css" as="style"><link rel="preload" href="/bootcamp/assets/js/app.7dbfbf9e.js" as="script"><link rel="preload" href="/bootcamp/assets/js/2.190e1afb.js" as="script"><link rel="preload" href="/bootcamp/assets/js/33.decc7469.js" as="script"><link rel="preload" href="/bootcamp/assets/js/9.58ca0658.js" as="script"><link rel="preload" href="/bootcamp/assets/js/8.5492b9a0.js" as="script"><link rel="prefetch" href="/bootcamp/assets/js/10.7fd3c48d.js"><link rel="prefetch" href="/bootcamp/assets/js/11.1dacc79b.js"><link rel="prefetch" href="/bootcamp/assets/js/12.d7c4a6ac.js"><link rel="prefetch" href="/bootcamp/assets/js/13.8d993d6d.js"><link rel="prefetch" href="/bootcamp/assets/js/14.a3887766.js"><link rel="prefetch" href="/bootcamp/assets/js/15.67f4e43b.js"><link rel="prefetch" href="/bootcamp/assets/js/16.35a3c718.js"><link rel="prefetch" href="/bootcamp/assets/js/17.e6c1ef57.js"><link rel="prefetch" href="/bootcamp/assets/js/18.b4920f4a.js"><link rel="prefetch" href="/bootcamp/assets/js/19.807fb2a2.js"><link rel="prefetch" href="/bootcamp/assets/js/20.3125be08.js"><link rel="prefetch" href="/bootcamp/assets/js/21.dcea33f4.js"><link rel="prefetch" href="/bootcamp/assets/js/22.d211252f.js"><link rel="prefetch" href="/bootcamp/assets/js/23.5b597e8d.js"><link rel="prefetch" href="/bootcamp/assets/js/24.d53527a2.js"><link rel="prefetch" href="/bootcamp/assets/js/25.64bf9fe1.js"><link rel="prefetch" href="/bootcamp/assets/js/26.de703df5.js"><link rel="prefetch" href="/bootcamp/assets/js/27.9610903c.js"><link rel="prefetch" href="/bootcamp/assets/js/28.0c9b3dc8.js"><link rel="prefetch" href="/bootcamp/assets/js/29.3ed4ea2a.js"><link rel="prefetch" href="/bootcamp/assets/js/3.58973244.js"><link rel="prefetch" href="/bootcamp/assets/js/30.f618317c.js"><link rel="prefetch" href="/bootcamp/assets/js/31.7f407d35.js"><link rel="prefetch" href="/bootcamp/assets/js/32.a2f4413e.js"><link rel="prefetch" href="/bootcamp/assets/js/34.6aca3d2d.js"><link rel="prefetch" href="/bootcamp/assets/js/35.d4ea897f.js"><link rel="prefetch" href="/bootcamp/assets/js/36.a9dc61e2.js"><link rel="prefetch" href="/bootcamp/assets/js/37.8051cb74.js"><link rel="prefetch" href="/bootcamp/assets/js/38.bb2cc257.js"><link rel="prefetch" href="/bootcamp/assets/js/39.8aee20c0.js"><link rel="prefetch" href="/bootcamp/assets/js/4.a50a3cf5.js"><link rel="prefetch" href="/bootcamp/assets/js/40.d2f4cf46.js"><link rel="prefetch" href="/bootcamp/assets/js/5.c5ca62bf.js"><link rel="prefetch" href="/bootcamp/assets/js/6.782840ac.js"><link rel="prefetch" href="/bootcamp/assets/js/7.af46f15a.js">
    <link rel="stylesheet" href="/bootcamp/assets/css/0.styles.c27c388f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bootcamp/" class="home-link router-link-active"><!----> <span class="site-name">IIJ Bootcamp</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/iij/bootcamp" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bootcamp/server-app/go/#_0-この講義について" class="sidebar-link">0. この講義について</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_0-1-この講義の目的" class="sidebar-link">0.1. この講義の目的</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_0-2-ハンズオンの対象者" class="sidebar-link">0.2. ハンズオンの対象者</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_0-3-下準備" class="sidebar-link">0.3. 下準備</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_0-4-この資料のお約束" class="sidebar-link">0.4. この資料のお約束</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_1-goとは" class="sidebar-link">1. Goとは</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_1-1-特徴" class="sidebar-link">1.1. 特徴</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_1-2-どこで使われているの" class="sidebar-link">1.2. どこで使われているの?</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_2-hello-世界" class="sidebar-link">2. Hello, 世界</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_2-1-goの基本的なコードの書き方を知る" class="sidebar-link">2.1. Goの基本的なコードの書き方を知る</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_2-2-解説" class="sidebar-link">2.2. 解説</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_2-3-まとめ" class="sidebar-link">2.3. まとめ</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_3-パッケージ-モジュール" class="sidebar-link">3. パッケージ/モジュール</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bootcamp/server-app/go/#_3-1-パッケージを分けて、モジュールを宣言する" class="sidebar-link">3.1 パッケージを分けて、モジュールを宣言する</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-1-作業ディレクトリの作成" class="sidebar-link">3.1.1. 作業ディレクトリの作成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-2-モジュール宣言ファイルの作成" class="sidebar-link">3.1.2. モジュール宣言ファイルの作成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-3-arithmeticパッケージディレクトリの作成" class="sidebar-link">3.1.3. arithmeticパッケージディレクトリの作成</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-4-arithmeticパッケージの定義" class="sidebar-link">3.1.4. arithmeticパッケージの定義</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-5-main関数の定義" class="sidebar-link">3.1.5. main関数の定義</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-6-コンパイルと実行" class="sidebar-link">3.1.6. コンパイルと実行</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-1-7-なんでパッケージを切るの-追加課題" class="sidebar-link">3.1.7. なんでパッケージを切るの?(追加課題)</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_3-2-解説" class="sidebar-link">3.2. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_4-型定義とメソッド" class="sidebar-link">4. 型定義とメソッド</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_4-1-ポケモンのダイマックスわざを出力したい" class="sidebar-link">4.1. ポケモンのダイマックスわざを出力したい</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_4-2-解説" class="sidebar-link">4.2. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_5-rest-api化" class="sidebar-link">5. REST API化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_5-1-apiサーバからダイマックスわざを取得したい" class="sidebar-link">5.1. APIサーバからダイマックスわざを取得したい</a></li><li class="sidebar-sub-header"><a href="/bootcamp/server-app/go/#_5-2-解説" class="sidebar-link">5.2. 解説</a></li></ul></li><li><a href="/bootcamp/server-app/go/#_6-まとめ" class="sidebar-link">6. まとめ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><table><tr><td>このハンズオンでやること</td><td>Go言語を使って簡単なWebアプリケーションを作ります</td></tr> <tr><td>想定時間</td><td>1.5h</td></tr> <tr><td>前提知識・用語</td><td>golang</td></tr></table> <h1 id="goでwebアプリケーションを作る"><a href="#goでwebアプリケーションを作る" class="header-anchor">#</a> GoでWebアプリケーションを作る</h1> <h2 id="_0-この講義について"><a href="#_0-この講義について" class="header-anchor">#</a> 0. この講義について</h2> <h3 id="_0-1-この講義の目的"><a href="#_0-1-この講義の目的" class="header-anchor">#</a> 0.1. この講義の目的</h3> <ul><li>Goについての概要の解説</li> <li>GoでWebアプリケーションを作る</li></ul> <p>上記を通してGoの特徴を知り、サービスや手元ツールなどの実装言語を選択する際の候補に挙げられることを目的としています。</p> <h3 id="_0-2-ハンズオンの対象者"><a href="#_0-2-ハンズオンの対象者" class="header-anchor">#</a> 0.2. ハンズオンの対象者</h3> <p>開発部署だけでなく、今後は運用等の部署でもプログラミングの能力を求められることが多くなると予想されます。 <br>
GoはWebサービスだけでなく、配布が楽という面もあり、部署内で使う小さな便利ツールを作る際にも有効な選択肢となり得ます。 <br>
そのため対象の部署に制限はありません。</p> <p>また、プログラム言語共通の制御構文などについては説明なく使うことがあります。 <br>
可能であれば何かしらのプログラム言語の経験があればより楽しめるかと思います。 <br>
// もちろん質問いただける分には歓迎します。</p> <h3 id="_0-3-下準備"><a href="#_0-3-下準備" class="header-anchor">#</a> 0.3. 下準備</h3> <p><a href="/bootcamp/server-app/go/init.html">GoでWebアプリケーションを作る(下準備編)</a>を参考に準備をおねがいします。</p> <p>本ハンズオンではdockerコンテナ内でファイルを編集し、コードをコンパイルし、実行する想定です。</p> <p>用意したdockerコンテナにはVim/Emacs/nanoといったエディタを用意しているため、好きなエディタを利用してください。 <br>
// 筆者はVimmerであるため例もVimで書きます。</p> <h3 id="_0-4-この資料のお約束"><a href="#_0-4-この資料のお約束" class="header-anchor">#</a> 0.4. この資料のお約束</h3> <p>💻 は自分で操作する箇所を示しています。 <br>
&lt;ほげほげ&gt; で囲まれている部分は自分の設定値で置き換えてください。</p> <p>また、<code>$</code>はプロンプトを意味し、実行の際に入力しません。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone <span class="token operator">&lt;</span>リモートリポジトリのアドレス<span class="token operator">&gt;</span>
</code></pre></div><p>たとえば上記のように記載されているとします。 <br>
リモートリポジトリのアドレスが<code>git@github.com:iij/bootcamp.git</code>の場合は以下のようにターミナル上で入力してください。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone git@github.com:iij/bootcamp.git
</code></pre></div><h2 id="_1-goとは"><a href="#_1-goとは" class="header-anchor">#</a> 1. Goとは</h2> <p>Googleが主導して開発しているプログラミング言語です。 <br>
ググラビリティが低いのでGolangやGo言語と書かれることもありますが、言語としての正式名称はGoです。 <br>
参考: <a href="https://twitter.com/rob_pike/status/886054143235719169" target="_blank" rel="noopener noreferrer">開発者の一人(Rob Pike 氏)のツイート<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-1-特徴"><a href="#_1-1-特徴" class="header-anchor">#</a> 1.1. 特徴</h3> <p>参考: <a href="https://budougumi0617.github.io/2019/06/20/golangtokyo25-read-again-awesome-go-article/" target="_blank" rel="noopener noreferrer">今改めて読み直したい Go基礎情報 その1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>
参考: <a href="https://www.slideshare.net/takuyaueda967/2016-go" target="_blank" rel="noopener noreferrer">Go入門<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_1-1-1-クロスコンパイルが簡単"><a href="#_1-1-1-クロスコンパイルが簡単" class="header-anchor">#</a> 1.1.1. クロスコンパイルが簡単</h4> <ul><li>標準パッケージ(ライブラリ)が、クロスコンパイルされることを前提としてOSごとの違いを吸収するように記述されています
<ul><li>もちろんLinuxにしかない機能、Windowsにしかない機能を直接触るようなアプリケーションを書く場合は、ほかの言語と同様に異なるOSで実行できるように書かなければなりません</li> <li>そのほか実行効率が良くなるように実装の最適化が行われていたりするので、標準パッケージ(ライブラリ)は積極的に利用しましょう</li></ul></li></ul> <h4 id="_1-1-2-学習コストが低い"><a href="#_1-1-2-学習コストが低い" class="header-anchor">#</a> 1.1.2. 学習コストが低い</h4> <ul><li>設計思想としてSimplicityを是としています
<ul><li>参考: <a href="https://talks.golang.org/2015/simplicity-is-complicated.slide#1" target="_blank" rel="noopener noreferrer">Simplicity is Complicated<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>言語仕様が小さくまとまっています
<ul><li>たとえば、使用されるキーワードは25個しかありません
<ul><li><a href="https://golang.org/ref/spec#Keywords" target="_blank" rel="noopener noreferrer">The Go Programming Language Specification#Keywords<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>参考: <a href="https://golang.org/ref/spec" target="_blank" rel="noopener noreferrer">The Go Programming Language Specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>最近大きな言語仕様追加の提案(型パラメータの実現)が出ていますが、現行有力なドラフト版の最新ではキーワードを追加せずに実現できる予定です
<ul><li>もう少し具体的には後述するinterfaceという機能を少し拡張することで対応されます</li></ul></li></ul></li> <li>抽象化のための言語機能が少ないため、愚直に実装する場面が多く、読み書きで迷うことがあまりありません</li></ul> <h4 id="_1-1-3-並行プログラミングが文法レベルでサポートされている"><a href="#_1-1-3-並行プログラミングが文法レベルでサポートされている" class="header-anchor">#</a> 1.1.3. 並行プログラミングが文法レベルでサポートされている</h4> <ul><li>Goroutine: 軽量スレッドのようなもの
<ul><li>一つのOSスレッド内に複数のGoroutineがスケジューリングされます</li></ul></li> <li>並列に動く、とは一言も言っていない点には注意が必要です
<ul><li>つまり、たとえばシングルコアのCPU上で動かすと並列には実行されないがコード上の記述は変わりません</li> <li>並列処理とは実際に処理が同時に行われることだが、並行処理とはプログラマーがコードに対して同時に動作するように命令することです
<ul><li>並列処理/並行処理の定義については諸説あるようですので、Goの文脈で語られることの多い定義は上記であると認識しておく必要があります</li> <li>参考: <a href="https://www.oreilly.co.jp/books/9784873118468/" target="_blank" rel="noopener noreferrer">Go言語による並行処理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li> <li>もちろんほか言語の並行処理機能と同様にうまく使わないと性能が出ないのでその点での優位性はほとんどないといってよいかもしれません
<ul><li>それはGoroutineが難しいのではなく、並行処理が難しいのです</li></ul></li></ul> <h4 id="_1-1-4-周辺ツールが標準で提供されている"><a href="#_1-1-4-周辺ツールが標準で提供されている" class="header-anchor">#</a> 1.1.4. 周辺ツールが標準で提供されている</h4> <ul><li>go build: ソースコードのビルド</li> <li>go test: テスト実行</li> <li>go fmt: コードフォーマッタ</li> <li>go vet: 静的解析</li> <li>go doc: ドキュメント生成</li> <li>go mod: モジュール管理</li> <li>...
<ul><li>参考: <a href="https://golang.org/cmd/" target="_blank" rel="noopener noreferrer">コマンド一覧<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h4 id="_1-1-5-標準パッケージが充実している"><a href="#_1-1-5-標準パッケージが充実している" class="header-anchor">#</a> 1.1.5. 標準パッケージが充実している</h4> <ul><li>testing: テスト記述</li> <li>net/http: HTTPサーバ/クライアントなど</li> <li>html/template: HTMLテンプレート(Pythonで言うjinja2みたいなもの)</li> <li>database/sql: DB操作</li> <li>...
<ul><li>参考: <a href="https://golang.org/pkg/" target="_blank" rel="noopener noreferrer">標準パッケージ一覧<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h3 id="_1-2-どこで使われているの"><a href="#_1-2-どこで使われているの" class="header-anchor">#</a> 1.2. どこで使われているの?</h3> <ul><li><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/docker/docker-ce" target="_blank" rel="noopener noreferrer">Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/x-motemen/ghq" target="_blank" rel="noopener noreferrer">ghq<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/peco/peco" target="_blank" rel="noopener noreferrer">peco<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>コンテナ関連(Kubernetes 関連)やCLIツールでの採用が多い印象です。</p> <h2 id="_2-hello-世界"><a href="#_2-hello-世界" class="header-anchor">#</a> 2. Hello, 世界</h2> <p><a href="https://play.golang.org/p/7vin2BK8_A6" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>
チュートリアルリポジトリの<code>hello_world</code>ディレクトリにサンプルコードが入っています。</p> <h3 id="_2-1-goの基本的なコードの書き方を知る"><a href="#_2-1-goの基本的なコードの書き方を知る" class="header-anchor">#</a> 2.1. Goの基本的なコードの書き方を知る</h3> <h4 id="_2-1-1-作業ディレクトリの作成"><a href="#_2-1-1-作業ディレクトリの作成" class="header-anchor">#</a> 2.1.1. 作業ディレクトリの作成</h4> <p>💻 以下のコマンドを実行して、作業ディレクトリを作成しましょう。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">mkdir</span> -p go_tutorial/hello_world
$ <span class="token builtin class-name">cd</span> go_tutorial/hello_world
</code></pre></div><h4 id="_2-1-2-ソースコードの記述"><a href="#_2-1-2-ソースコードの記述" class="header-anchor">#</a> 2.1.2. ソースコードの記述</h4> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/hello_world/main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> main.go
</code></pre></div><h4 id="_2-1-3-コンパイルと実行"><a href="#_2-1-3-コンパイルと実行" class="header-anchor">#</a> 2.1.3. コンパイルと実行</h4> <p>💻 以下のコマンドで書いたコードを実行しましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">チェックポイント1 🏁</p> <p>2.1.3. を実行して以下の出力が得られたらクリア!</p> <div class="language- extra-class"><pre class="language-text"><code>Hello, 世界
</code></pre></div></div> <h4 id="_2-1-4-どこまでが言語仕様-追加課題"><a href="#_2-1-4-どこまでが言語仕様-追加課題" class="header-anchor">#</a> 2.1.4. どこまでが言語仕様?(追加課題)</h4> <p>余裕がある人は以下の課題をやってみましょう。</p> <p>実行ファイルには<code>main</code>という文字列が3箇所表れます。これらのうち、一言一句<code>main</code>という文字列でなければならないところはどこでしょうか。</p> <p><code>main</code>が表れる3箇所とは以下のことです。</p> <ul><li>ファイル名: <code>main.go</code></li> <li><code>package</code>の直後: <code>package main</code></li> <li><code>func</code>の直後: <code>func main() {</code></li></ul> <p>💻 上記を一つずつ<code>main</code>から適当な文字列に変えながら2.1.3.と同様に<code>go run</code>を実行してください。</p> <p>実行できなかった場合はどのようなエラーが出力されるのかを確認しましょう。</p> <p>💻 さらに余裕がある人は実行できなかった部分について、その根拠となる文言を以下の仕様書から探してみましょう。</p> <ul><li><a href="https://golang.org/ref/spec#Program_initialization_and_execution" target="_blank" rel="noopener noreferrer">The Go Programming Language Specification#Program_initialization_and_execution<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="_2-2-解説"><a href="#_2-2-解説" class="header-anchor">#</a> 2.2. 解説</h3> <h4 id="_2-2-0-the-go-playground"><a href="#_2-2-0-the-go-playground" class="header-anchor">#</a> 2.2.0. The Go Playground</h4> <p><a href="https://play.golang.org" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>はGoのプログラムを手軽に実行できる環境で、Go公式によって用意されています。</p> <p>HTTPサーバなどは実行してもアクセスできないので意味はないですが、簡単なコードを試しに動かしたり、コード片を共有するときに非常に便利です。</p> <p>念の為ですが、センシティブな情報(実際の顧客情報やパスワードなど)をここで入力してはいけません。</p> <h4 id="_2-2-1-パッケージの宣言"><a href="#_2-2-1-パッケージの宣言" class="header-anchor">#</a> 2.2.1. パッケージの宣言</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
</code></pre></div><p>Goのプログラムはパッケージ単位で構成されます。 <br>
そして、Goのプログラムは必ず<code>main</code>パッケージから実行されます。 <br>
たとえば、先の例でpackage名を<code>hoge</code>にするとエラーが返ってきます。</p> <ul><li><code>main.go</code> <a href="https://play.golang.org/p/rlUktSgVozz" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> hoge

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ go run test.go
go run: cannot run non-main package
</code></pre></div><p><code>main</code>ではないpackageから実行することはできません。という内容のエラーが返ってきます。</p> <h4 id="_2-2-2-外部パッケージの読み込み"><a href="#_2-2-2-外部パッケージの読み込み" class="header-anchor">#</a> 2.2.2. 外部パッケージの読み込み</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
</code></pre></div><p>他パッケージで定義された関数などを<code>import</code>文で読み込むことができます。 <br>
ここでは<a href="https://golang.org/pkg/fmt" target="_blank" rel="noopener noreferrer"><code>fmt</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>という標準パッケージで定義された関数(<a href="https://golang.org/pkg/fmt/#Println" target="_blank" rel="noopener noreferrer"><code>Println</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)を実行したいので、事前にここで読み込む必要があります。</p> <div class="language-go extra-class"><pre class="language-go"><code>  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-2-3-関数の定義"><a href="#_2-2-3-関数の定義" class="header-anchor">#</a> 2.2.3. 関数の定義</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, 世界&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Go の関数定義は<code>func</code>キーワードで行います。 <br>
ここで<code>main</code>という名前の引数と戻り値のない関数を定義しています。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>Goでコンパイルされた実行可能ファイルは<code>main</code>パッケージで定義された<code>main</code>関数から実行されます。 <br> <code>fmt.Println()</code>は標準出力に引数の文字列(ここでは<code>Hello, 世界</code>)を出力します。</p> <h3 id="_2-3-まとめ"><a href="#_2-3-まとめ" class="header-anchor">#</a> 2.3. まとめ</h3> <ul><li>Goのコードは<code>main</code>パッケージの<code>main</code>関数(引数戻り値なし)から実行されます</li> <li>標準出力に文字列を出力させる関数(のうちの一つ)は<code>fmt.Println()</code>です</li> <li>外部パッケージの関数を呼び出すためには事前に<code>import</code>文を用いてパッケージを読み込む必要があります</li></ul> <h2 id="_3-パッケージ-モジュール"><a href="#_3-パッケージ-モジュール" class="header-anchor">#</a> 3. パッケージ/モジュール</h2> <p><a href="https://play.golang.org/p/gRneR3EcYRB" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>チュートリアルリポジトリの<code>calc</code>ディレクトリにサンプルコードが入っています</li> <li>The Go Playground固有の記法として<code>-- dir/file --</code>という文字列で区切れば複数ファイルを記述できます</li></ul> <h2 id="_3-1-パッケージを分けて、モジュールを宣言する"><a href="#_3-1-パッケージを分けて、モジュールを宣言する" class="header-anchor">#</a> 3.1 パッケージを分けて、モジュールを宣言する</h2> <h3 id="_3-1-1-作業ディレクトリの作成"><a href="#_3-1-1-作業ディレクトリの作成" class="header-anchor">#</a> 3.1.1. 作業ディレクトリの作成</h3> <p>💻 以下のコマンドを実行して、作業ディレクトリを作成しましょう。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span> <span class="token comment"># go_tutorial/hello_world ディレクトリにいることを想定</span>
$ <span class="token function">mkdir</span> calc
$ <span class="token builtin class-name">cd</span> calc
</code></pre></div><h3 id="_3-1-2-モジュール宣言ファイルの作成"><a href="#_3-1-2-モジュール宣言ファイルの作成" class="header-anchor">#</a> 3.1.2. モジュール宣言ファイルの作成</h3> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/calc/go.mod</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code>module calc
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> go.mod
</code></pre></div><h3 id="_3-1-3-arithmeticパッケージディレクトリの作成"><a href="#_3-1-3-arithmeticパッケージディレクトリの作成" class="header-anchor">#</a> 3.1.3. <code>arithmetic</code>パッケージディレクトリの作成</h3> <p>💻 以下のコマンドを実行して、後に定義する<code>arithmetic</code>パッケージ用のディレクトリを作成しましょう。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">mkdir</span> arithmetic
</code></pre></div><h3 id="_3-1-4-arithmeticパッケージの定義"><a href="#_3-1-4-arithmeticパッケージの定義" class="header-anchor">#</a> 3.1.4. <code>arithmetic</code>パッケージの定義</h3> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/calc/arithmetic/add.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> arithmetic

<span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  c <span class="token operator">:=</span> a <span class="token operator">+</span> b
  <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> arithmetic/add.go
</code></pre></div><h3 id="_3-1-5-main関数の定義"><a href="#_3-1-5-main関数の定義" class="header-anchor">#</a> 3.1.5. <code>main</code>関数の定義</h3> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/calc/main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;calc/arithmetic&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>arithmetic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> main.go
</code></pre></div><h3 id="_3-1-6-コンパイルと実行"><a href="#_3-1-6-コンパイルと実行" class="header-anchor">#</a> 3.1.6. コンパイルと実行</h3> <p>💻 以下のコマンドで書いたコードを実行しましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">チェックポイント2 🏁</p> <p>3.1.6. を実行して以下の出力が得られたらクリア!</p> <div class="language- extra-class"><pre class="language-text"><code>3
</code></pre></div></div> <h3 id="_3-1-7-なんでパッケージを切るの-追加課題"><a href="#_3-1-7-なんでパッケージを切るの-追加課題" class="header-anchor">#</a> 3.1.7. なんでパッケージを切るの?(追加課題)</h3> <p>余裕がある人は以下の課題をやってみましょう。</p> <p>💻 <code>calc</code>モジュールに引き算処理を追加するならどのファイルに追加するのが良いか考えてみましょう。</p> <div class="custom-block tip"><p class="custom-block-title">ヒント</p> <p><code>go_tutorial/calc/add.go</code>に置くもよし、<code>go_tutorial/calc/</code> 内に別ファイルとして置くもよし。 <br>
もちろんそのほかの置き方もあるでしょう。 <br>
自分が自然だと思う方法で配置して、なぜそれを自分が自然と思えたか/そのほかを自然と思えなかったのかを考えてみましょう。</p></div> <p>💻 <code>calc</code>モジュールにsin関数による計算処理を追加するならどのファイルに追加するのが良いか考えてみましょう。</p> <h3 id="_3-2-解説"><a href="#_3-2-解説" class="header-anchor">#</a> 3.2. 解説</h3> <h4 id="_3-2-1-go-mod"><a href="#_3-2-1-go-mod" class="header-anchor">#</a> 3.2.1. <code>go.mod</code></h4> <p>このファイルはGoのコードを外部から読み込むときの名前を定義したり、ソースコードで利用している外部モジュールは何か、そのバージョンは何かなどの情報を記述するためのファイルです。 <br>
RubyだとGemfileに相当します。</p> <div class="language-go extra-class"><pre class="language-go"><code>module test
</code></pre></div><p>このように書くことで、このモジュールは<code>test</code>という名前であると宣言し、その名前で外部から呼べるようになります。 <br>
TODO: この<code>test</code>モジュールを外から呼ぶのは難しいこととその理由を簡単に書く</p> <p><code>main.go</code>ファイルの中には以下のような記述があります。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;calc/arithmetic&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>ここで<code>calc/arithmetic</code>というのは<code>calc</code>モジュールの<code>arithmetic</code>パッケージを読み込んでいると解釈されます。 <br>
また、<code>calc/arithmetic</code>ではディレクトリ構造も指定されており、Goコンパイラは<code>arithmetic</code>パッケージを探す際に以下のようなディレクトリに配置されていることを前提とします。</p> <div class="language- extra-class"><pre class="language-text"><code>- calc/
  - main.go (`package main`と宣言されている)
  - arithmetic/
    - add.go (`package arithmetic`と宣言されている)
</code></pre></div><p>Goでいうパッケージのような、ソースコードを分類するための機構(名前空間とも言う)は様々な言語に存在します。 <br>
// Rubyでいうmodule、Javaのpackageなどなど...</p> <p>名前空間を切る理由は様々あるかと思いますが、一つは同じ役割の処理を同じ名前空間内に入れることで、ソースコードを読みやすく、機能追加しやすくするという目的があります。 <br>
今回のサンプルに引き算をする処理を追加するとしたらどこに配置するのが自然かを考えてみてください。 <br>
またsin関数の計算処理を追加するとしたらどこが良いでしょうか。</p> <p>一つの回答例は以下のようになるかと思います。</p> <div class="language- extra-class"><pre class="language-text"><code>- calc/
  - main.go
  - trigonometric/
    - sin.go (sin関数の計算処理が記述される)
  - arithmetic/
    - add.go
    - del.go (引き算の処理が記述される)
</code></pre></div><p>パッケージをどのように切るのかについては様々な議論があります。それぞれメリットデメリットがあり、銀の弾丸は存在しません。もちろん私も試行錯誤を繰り返しています。 <br>
みなさんも自分のツールを書く際はいろいろ試してみると良いかと思います。 \</p> <h4 id="_3-2-2-続・func"><a href="#_3-2-2-続・func" class="header-anchor">#</a> 3.2.2. 続・func</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Add</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  c <span class="token operator">:=</span> a <span class="token operator">+</span> b
  <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><p>今回定義した<code>Add()</code>関数を読んでいきましょう。</p> <p>まず最初の行では<code>Add()</code>関数はどういう型の引数を取り、どういう型の返り値を返すのかを定義します。 <br>
今回は<code>int</code>型の<code>a</code>、<code>b</code>二つの引数を取り、<code>int</code>型の値を返すという定義になっています。 \</p> <p>また、Goの型名は変数宣言の後ろに書くことに注意しましょう。 <br>
参考: <a href="https://blog.golang.org/gos-declaration-syntax" target="_blank" rel="noopener noreferrer">Go's Declaration Syntax<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>Add()</code>関数の最初の文字が大文字になっていることを疑問に思った方がおられるかもしれません。 <br>
これはパッケージの外からその関数が呼び出せるかどうかを制御するための仕組みです。 <br>
// Javaでいう<code>private</code>/<code>protected</code>/<code>public</code>のようなものですが、Goにはパッケージ単位でしか公開非公開を制御することはできません。</p> <p>他の言語では公開すると宣言するための特別な文字列(<code>public</code>のような)がありますが、Goではただ大文字から始めるだけで外部から呼び出せるようになります。 <br>
ここまで使ってきた関数に<code>fmt.Println()</code>がありますが、これも同じルールに従っていることが分かります。 <br>
つまり<code>main</code>パッケージから見て外部パッケージである<code>fmt</code>パッケージの関数を呼び出しているので関数名は大文字から始まっている必要があります。</p> <p>Go での変数宣言にはいくつか方法があり、一番単純なのは今回使用した、</p> <div class="language-go extra-class"><pre class="language-go"><code>c <span class="token operator">:=</span> a <span class="token operator">+</span> b
</code></pre></div><p>の形式です。 <br>
ここで他の(一部の)静的型付言語を利用したことのある方は<code>c</code>の型を指定していないじゃないか、と思われるかもしれません。 <br>
ここでは<code>+</code>という演算子が左被演算子、右被演算子、返り値の型が全て同一であるということと<code>a</code>、<code>b</code>の型が<code>int</code>であることからGoコンパイラがよしなに<code>c</code>は<code>int</code>型であると判断してくれるので記述する必要がありません。 <br>
これはHaskell等の言語にも採用されている型推論という機能によるものです。
// もちろんHaskellのような強力な型推論をしてくれる訳ではありませんので、このような自明な場合のみ補助してくれる程度です。</p> <p>以下のように明示的に型名を書くことも出来ます。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> c <span class="token builtin">int</span> <span class="token operator">=</span> a <span class="token operator">+</span> b
</code></pre></div><p>また、</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b
</code></pre></div><p>という宣言方法もあります。 <br> <code>:=</code>による宣言は関数定義の中でしか書けないという制約があります。 <br>
そのため、グローバル変数の宣言など関数の外部で変数を宣言したい場合は<code>:=</code>による宣言を使用できず、<code>var</code>による宣言をする必要があります。</p> <p>最後に<code>Add()</code>関数を呼び出している部分を見てみましょう。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>arithmetic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>外部パッケージで公開されたものを使う際は<code>fmt.Println()</code>のように<code>&lt;パッケージ名&gt;.&lt;関数名&gt;</code>という形式を取ります。 <br>
// ここで&quot;もの&quot;としたのは関数だけではなく変数や型も同様の方法で公開することができるからです。</p> <p><code>arithmetic</code>パッケージの<code>Add()</code>関数を呼び出したいので<code>arithmetic.Add()</code>のように呼び出します。</p> <p>ここでは更に<code>arithmetic.Add()</code>の返り値をそのまま<code>fmt.Println()</code>で標準出力に出力させています。</p> <h2 id="_4-型定義とメソッド"><a href="#_4-型定義とメソッド" class="header-anchor">#</a> 4. 型定義とメソッド</h2> <p><a href="https://play.golang.org/p/Ne2xRnC0Ggl" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>チュートリアルリポジトリの<code>pokemon</code>ディレクトリにサンプルコードが入っています</li></ul> <h3 id="_4-1-ポケモンのダイマックスわざを出力したい"><a href="#_4-1-ポケモンのダイマックスわざを出力したい" class="header-anchor">#</a> 4.1. ポケモンのダイマックスわざを出力したい</h3> <p><a href="https://tepppei.hatenablog.com/entry/2020/07/25/230828" target="_blank" rel="noopener noreferrer">なんでもかんでもポケモンで例えれば分かりやすいってみんな言ってる!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_4-1-1-作業ディレクトリの作成"><a href="#_4-1-1-作業ディレクトリの作成" class="header-anchor">#</a> 4.1.1. 作業ディレクトリの作成</h4> <p>💻 以下のコマンドを実行して、作業ディレクトリを作成しましょう。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span> <span class="token comment"># go_tutorial/calc ディレクトリにいることを想定</span>
$ <span class="token function">mkdir</span> pokemon
$ <span class="token builtin class-name">cd</span> pokemon
</code></pre></div><h4 id="_4-1-2-ソースコードの記述"><a href="#_4-1-2-ソースコードの記述" class="header-anchor">#</a> 4.1.2. ソースコードの記述</h4> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/pokemon/main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Pokemon <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID    <span class="token builtin">int</span>
	Name  <span class="token builtin">string</span>
	moves <span class="token punctuation">[</span><span class="token punctuation">]</span>Move
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p Pokemon<span class="token punctuation">)</span> <span class="token function">Moves</span><span class="token punctuation">(</span>isDynamax <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> isDynamax <span class="token punctuation">{</span>
		dynamaxMoves <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
			dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>

			dynamaxMoves <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dynamaxMoves<span class="token punctuation">,</span> dynMove<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> dynamaxMoves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> p<span class="token punctuation">.</span>moves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Move <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
	Type <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m Move<span class="token punctuation">)</span> <span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> m<span class="token punctuation">.</span>Type <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイソウゲン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイバーン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイストリーム&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;unknown type&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> party <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Pokemon<span class="token punctuation">{</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;つるのむち&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;リザードン&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;かえんほうしゃ&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;カメックス&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;みずでっぽう&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	venusaur <span class="token operator">:=</span> party<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ポケモン:&quot;</span><span class="token punctuation">,</span> venusaur<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> venusaur<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;通常わざ:&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

	dynMoves<span class="token punctuation">,</span> err <span class="token operator">:=</span> venusaur<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ダイマックスわざ:&quot;</span><span class="token punctuation">,</span> dynMoves<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_4-1-3-コンパイルと実行"><a href="#_4-1-3-コンパイルと実行" class="header-anchor">#</a> 4.1.3. コンパイルと実行</h4> <p>💻 以下のコマンドで書いたコードを実行しましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">チェックポイント1 🏁</p> <p>4.1.3. を実行して以下の出力が得られたらクリア</p> <div class="language- extra-class"><pre class="language-text"><code>ポケモン: フシギバナ
通常わざ: つるのむち
ダイマックスわざ: ダイソウゲン
</code></pre></div></div> <h3 id="_4-2-解説"><a href="#_4-2-解説" class="header-anchor">#</a> 4.2. 解説</h3> <h4 id="_4-2-1-型定義といくつかの型"><a href="#_4-2-1-型定義といくつかの型" class="header-anchor">#</a> 4.2.1. 型定義といくつかの型</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Pokemon <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID    <span class="token builtin">int</span>
	Name  <span class="token builtin">string</span>
	moves <span class="token punctuation">[</span><span class="token punctuation">]</span>Move
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Move <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
	Type <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>他の言語と同じようにGoには型を定義する機能があります。 <br>
ここでは<code>Pokemon</code>(ポケモン)と<code>Move</code>(わざ)という型を定義しています。</p> <div class="custom-block tip"><p class="custom-block-title">なんのために型を定義するのか</p> <p>型システムとは何であるかについては<a href="https://www.ohmsha.co.jp/book/9784274069116/" target="_blank" rel="noopener noreferrer">TaPL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>の1章を読むとよいでしょう。 <br>
いくつかの観点がありますが、以下のようなものがあるでしょう。</p> <ul><li>その型が行なえる処理を制限できる</li> <li>関連するふるまいに名前を付けれる</li> <li>代入する値のある程度の正しさをプログラムを実行することなく(静的に)検証できる</li></ul> <p>これらが真にメリットであると感じるためにはいくつかのプログラム言語を触るのがてっとり早いでしょう。</p></div> <p>型を定義するときにはその基となる型を指定する必要があります。 <br>
ここでは<code>struct</code>型(構造体型)を基としています。</p> <p>もちろん別な型を基にすることも可能です。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> URL <span class="token builtin">string</span>
</code></pre></div><p>このように<code>URL</code>という型を<code>string</code>型を基として定義しました。</p> <p>では<code>struct</code>型とは何でしょうか。</p> <p><code>struct</code>型は関連するデータをまとめて保持するための型です。 <br>
Cなどの言語でも同様な構造体型が存在します。</p> <p>その他にも<code>[]Move</code>のような<code>[]</code>を型名の前に付けることで定義されるスライス(可変長のリストみたいなもの)も使用しています。</p> <p>詳細な文法は置いておいて、実際今回はどのように使っているかだけに注目します。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> party <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Pokemon<span class="token punctuation">{</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;つるのむち&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;リザードン&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;かえんほうしゃ&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;カメックス&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;みずでっぽう&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>[]Pokemon</code>型の変数<code>party</code>を宣言しています。 <br>
ここでは<code>フシキバナ</code>、<code>リザードン</code>、<code>カメックス</code>の3匹のポケモンをパーティに加えています。</p> <div class="language-go extra-class"><pre class="language-go"><code>	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;つるのむち&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><code>フシギバナ</code>の定義を追っていきます。 <br>
これは<code>Pokemon</code>型の値を書いています。</p> <ul><li><code>ID</code>という<code>int</code>型のフィールドには<code>3</code></li> <li><code>Name</code>という<code>string</code>型のフィールドには<code>フシギバナ</code></li> <li><code>moves</code>という<code>[]Move</code>型のフィールドには...</li></ul> <p>という形で定義しています。 <br>
つまりIDが<code>3</code>で名前が<code>フシギバナ</code>であるポケモンは<code>つるのむち</code>という<code>くさ</code>タイプのわざを覚えているということが表現されています。</p> <p>この<code>party</code>に保持された最初の要素を取得する部分を見ます。</p> <div class="language-go extra-class"><pre class="language-go"><code>	venusaur <span class="token operator">:=</span> party<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><p>// <code>venusaur</code>はフシギバナの英語名</p> <p>同様に<code>party[1]</code>でリザードンが取得できます。</p> <p>更に<code>venusaur</code>変数の<code>Name</code>フィールドを取得するには<code>venusaur.Name</code>とします。</p> <div class="language-go extra-class"><pre class="language-go"><code>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ポケモン:&quot;</span><span class="token punctuation">,</span> venusaur<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Goの<code>fmt.Println()</code>関数は<code>,</code>で区切られた値を半角スペースで繋いで表示します。</p></div> <h4 id="_4-2-2-メソッド定義"><a href="#_4-2-2-メソッド定義" class="header-anchor">#</a> 4.2.2 メソッド定義</h4> <p>まずは! <br>
ポケモン的前提知識について書きます。</p> <p>ポケモン最新作ソード&amp;シールドではダイマックス(英語では<code>dynamax</code>)という要素が追加されました。 <br>
これをすると戦闘中にいきなり巨大化し、わざもタイプに応じて強力なものに変化します。</p> <p>これをプログラムで表現したいというのが今回のサンプルです。</p> <p>ある型についてその型に関連する関数(メソッドと呼ぶ)を定義できます。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>p Pokemon<span class="token punctuation">)</span> <span class="token function">Moves</span><span class="token punctuation">(</span>isDynamax <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> isDynamax <span class="token punctuation">{</span>
		dynamaxMoves <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
			dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>

			dynamaxMoves <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dynamaxMoves<span class="token punctuation">,</span> dynMove<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> dynamaxMoves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> p<span class="token punctuation">.</span>moves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m Move<span class="token punctuation">)</span> <span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> m<span class="token punctuation">.</span>Type <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイソウゲン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイバーン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイストリーム&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;unknown type&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ここで<code>Pokemon</code>型には<code>Moves()</code>メソッドを、<code>Move</code>型には<code>dynamax()</code>メソッドを定義しました。 <br>
定義方法はほとんど関数定義と同じですが、関数名の前にそのメソッドを定義する型を記述することに注意しましょう。 <br>
ここで型名の前に変数名を書くことでメソッドの本体でその変数を利用できます。</p> <div class="custom-block tip"><p class="custom-block-title">Goはオブジェクト指向言語なの?</p> <p>これについては公式で明確に(<code>Yes and no.</code>)回答されています。<a href="https://golang.org/doc/faq#Is_Go_an_object-oriented_language" target="_blank" rel="noopener noreferrer">Is Go an object-oriented language?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>を参照してください。 <br>
この回答をよく読むと<code>Yes and no.</code>と回答しておきながら、何故そうであるのかについては直接語られていません。 <br>
ただただGoにおける言語機能を他の言語と比較しているだけです。 <br>
アラン・ケイによる定義から様々な派生的な定義が発生してしまっている(要出典)オブジェクト指向という言葉に触れてしまうと、その定義を明確にすることだけで精一杯になってしまいます。 <br>
Goで何ができるのかだけを列挙することで、<code>Yes and no.</code>である理由については読者が自身の定義と関連付けて考えよ、ということだと私は解釈しています。 <br>
実際、大半のプログラム言語のユーザとしては、それがオブジェクト指向言語であるかどうかやオブジェクト指向言語とは何であるかというのは重要な情報ではなく、その言語には何が出来るのかが重要なのです。 <br>
ここではGoには型を定義するための機能があり、その型にメソッドが定義できるということのみが重要です。</p></div> <p>よく使う制御構文である<code>if</code>/<code>for</code>/<code>switch</code>についても使い方はなんとなく分かるでしょうか。</p> <p><code>(Pokemon).Moves()</code>は<code>isDynamax</code>でダイマックス状態かどうかのbool値を引数に取り、<code>false</code>であればそのまま<code>moves</code>フィールドの値を返し、<code>true</code>なら<code>moves</code>の中身を全てダイマックスわざに変換したスライスを新たに作って返します。</p> <p><code>(Move).dynamax()</code>は<code>Type</code>フィールドの値に応じて、対応するダイマックスわざを返します。</p> <div class="language-go extra-class"><pre class="language-go"><code>		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
			dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>

			dynamaxMoves <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dynamaxMoves<span class="token punctuation">,</span> dynMove<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
</code></pre></div><p><code>for</code>は少し特徴的です。 <br> <code>range</code>の後に配列またはスライスを配置することで、その要素のインデックスを1つ目の変数に、その値を2つ目の変数に入れることができます。 <br>
今回のようにインデックスを使わない場合には<code>_</code>と書くことで使わないことを明記します。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">for</span> i<span class="token punctuation">,</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
</code></pre></div><p>と記述するとコンパイルエラーとなります。 <br>
Goでは使ってない変数はバグの元なのでそもそもコンパイル時点排除するという言語仕様になっています。</p> <p>また、</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">for</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
</code></pre></div><p>とすると想定とは違う挙動になります。 <br> <code>range</code>は変数定義は1つだけの場合はインデックスだけを代入します。</p></div> <p>メソッドを実際に呼び出している部分は以下です。</p> <div class="language-go extra-class"><pre class="language-go"><code>	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> venusaur<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-2-3-エラー処理"><a href="#_4-2-3-エラー処理" class="header-anchor">#</a> 4.2.3. エラー処理</h4> <div class="language-go extra-class"><pre class="language-go"><code>	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> venusaur<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>や</p> <div class="language-go extra-class"><pre class="language-go"><code>	dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
</code></pre></div><p>といった部分で触れませんでしたが、この記述もGoの特徴的な記述です。</p> <p>Goにはほかの言語にあるような強力な例外機構は存在しません(<code>panic()</code>/<code>recover()</code>という組込み関数は存在します)。 <br>
これはGoがエラー処理の方法として、例外ではなく明示的なエラー値の返却という戦略を採用しているからです。</p> <p>Goは今回のサンプルのように複数の値を返す関数が記述できます。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>m Move<span class="token punctuation">)</span> <span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> m<span class="token punctuation">.</span>Type <span class="token punctuation">{</span>
		<span class="token comment">/* ... */</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;unknown type&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>これを利用して、何かエラーが発生するかもしれない関数では戻り値の最後に<code>error</code>型(標準で用意された型)を返します。</p> <p>この関数/メソッドを実行する側では、以下のように<code>error</code>型返り値の内容によって処理を分岐します。</p> <div class="language-go extra-class"><pre class="language-go"><code>	dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// errに何か値が入っていた場合は</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// そのままエラーを返す</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> venusaur<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token comment">// errに何か値が入っていた場合は</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// そのエラーを標準出力に表示して</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token comment">// Exit code 1 でプログラムを終了する</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>大抵は受けとったエラーをそのまま実行元に返して、<code>main()</code>関数のような最上位でログに出力したり、APIサーバであればクライアントにエラーコードとともにエラーレスポンスとして返したりします。</p> <p>私は例外機構を持つ言語の経験がほとんどないので比較については当日TAの人に伺いますね。</p> <h2 id="_5-rest-api化"><a href="#_5-rest-api化" class="header-anchor">#</a> 5. REST API化</h2> <p><a href="https://play.golang.org/p/DPtuK29Q1nt" target="_blank" rel="noopener noreferrer">The Go Playground<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>実行してもしばらく経って<code>timeout running program</code>というエラーが返ってきます</li> <li>チュートリアルリポジトリの<code>poke_api</code>ディレクトリにサンプルコードが入っています</li></ul> <h3 id="_5-1-apiサーバからダイマックスわざを取得したい"><a href="#_5-1-apiサーバからダイマックスわざを取得したい" class="header-anchor">#</a> 5.1. APIサーバからダイマックスわざを取得したい</h3> <h4 id="_5-1-1-作業ディレクトリの作成"><a href="#_5-1-1-作業ディレクトリの作成" class="header-anchor">#</a> 5.1.1. 作業ディレクトリの作成</h4> <p>💻 以下のコマンドを実行して、作業ディレクトリを作成しましょう。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span> <span class="token comment"># go_tutorial/pokemon ディレクトリにいることを想定</span>
$ <span class="token function">mkdir</span> poke_api
$ <span class="token builtin class-name">cd</span> poke_api
</code></pre></div><h4 id="_5-1-2-ソースコードの記述"><a href="#_5-1-2-ソースコードの記述" class="header-anchor">#</a> 5.1.2. ソースコードの記述</h4> <p>💻 好きなエディタで以下のファイルを作成しましょう。</p> <ul><li><code>go_tutorial/http_hello/main.go</code></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;encoding/json&quot;</span>
	<span class="token string">&quot;errors&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;path&quot;</span>
	<span class="token string">&quot;strconv&quot;</span>
	<span class="token string">&quot;strings&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Pokemon <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID    <span class="token builtin">int</span>
	Name  <span class="token builtin">string</span>
	moves <span class="token punctuation">[</span><span class="token punctuation">]</span>Move
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p Pokemon<span class="token punctuation">)</span> <span class="token function">Moves</span><span class="token punctuation">(</span>isDynamax <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> isDynamax <span class="token punctuation">{</span>
		dynamaxMoves <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> move <span class="token operator">:=</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>moves <span class="token punctuation">{</span>
			dynMove<span class="token punctuation">,</span> err <span class="token operator">:=</span> move<span class="token punctuation">.</span><span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>

			dynamaxMoves <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dynamaxMoves<span class="token punctuation">,</span> dynMove<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> dynamaxMoves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> p<span class="token punctuation">.</span>moves<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Move <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
	Type <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m Move<span class="token punctuation">)</span> <span class="token function">dynamax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Move<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> m<span class="token punctuation">.</span>Type <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイソウゲン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイバーン&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span>
			Name<span class="token punctuation">:</span> <span class="token string">&quot;ダイストリーム&quot;</span><span class="token punctuation">,</span>
			Type<span class="token punctuation">:</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> Move<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;unknown type&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> party <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Pokemon<span class="token punctuation">{</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;つるのむち&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;くさ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;リザードン&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;かえんほうしゃ&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;ほのお&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;カメックス&quot;</span><span class="token punctuation">,</span> moves<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Move<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;みずでっぽう&quot;</span><span class="token punctuation">,</span> Type<span class="token punctuation">:</span> <span class="token string">&quot;みず&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getParty</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> party<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getPokemon</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	indexParam <span class="token operator">:=</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
	index<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>indexParam<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> index <span class="token operator">&gt;</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> party<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getMove</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	indexParam <span class="token operator">:=</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
	index<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>indexParam<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> index <span class="token operator">&gt;</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	poke <span class="token operator">:=</span> party<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> poke<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> moves<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">router</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> path<span class="token punctuation">.</span><span class="token function">Clean</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">:=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getParty</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party/[0-5]&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getPokemon</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party/[0-5]/move&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getMove</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

	err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// === 以下は JSON をクライアントに返すための細かい制御をするための関数 ===</span>

<span class="token keyword">func</span> <span class="token function">renderError</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">,</span> code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// JSONで返すので&quot;Content-Type&quot;ヘッダに&quot;application/json&quot;を指定します。</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// 引数で指定されたレスポンスコードを登録します。</span>
	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

	ret <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		<span class="token comment">// `json:&quot;error&quot;`というのは構造体型のアノテーションと呼ばれるもので、特定の関数に構造体の情報を伝えるために使います。</span>
		<span class="token comment">// この場合はJSONに変換されるとき`error`というフィールド名にすることを指示しています。</span>
		Error <span class="token builtin">string</span> <span class="token string">`json:&quot;error&quot;`</span>
	<span class="token punctuation">}</span><span class="token punctuation">{</span>
		Error<span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;render error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/*
	   enc := json.NewEncoder(w)
	   err := enc.Encode(ret)
	   if err != nil {
	     log.Println(&quot;render error&quot;, err)
	   }
	   と同等
	*/</span>
<span class="token punctuation">}</span>

<span class="token comment">// interface{}型というのは、メソッドが一つも定義されていないインターフェイスを意味します。</span>
<span class="token comment">// つまり任意の型はinterface{}型を満たします。</span>
<span class="token comment">// Goではインタフェースは明示的に書かずともインタフェース型で定義されたメソッドを全て定義した型は、</span>
<span class="token comment">// そのインタフェースを満たしている、と判断されます。</span>
<span class="token comment">// このような値を引数にとることで、静的型付言語でありながら、任意の型を引数に取る関数を簡単に作ることができます。</span>
<span class="token keyword">func</span> <span class="token function">renderResponse</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;render error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> main.go
</code></pre></div><h4 id="_5-1-3-別ターミナルの準備"><a href="#_5-1-3-別ターミナルの準備" class="header-anchor">#</a> 5.1.3. 別ターミナルの準備</h4> <p>今回のコードはサーバアプリケーションなので素朴に<code>go run main.go</code>で実行してしまうとプロンプトが返ってこず、動作確認が面倒です。 <br>
そのため今回はターミナルを2つ用意する方針で実行します。</p> <p>💻 これまで使用していたターミナルとは別のターミナルを用意し、以下のコマンドを実行しましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it go-tutor /bin/bash
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>go-tutor</code>コンテナで<code>/bin/bash</code>を実行するコマンドです。</p></div> <h4 id="_5-1-4-httpサーバの起動"><a href="#_5-1-4-httpサーバの起動" class="header-anchor">#</a> 5.1.4. HTTPサーバの起動</h4> <p>💻 以下のコマンドでHTTPサーバを起動しましょう。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go run main.go
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">チェックポイント3 🏁</p> <p>HTTPサーバを起動したのとは別のターミナル上で以下のコマンドを実行しましょう。 <br>
出力が同じであればクリア!</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">curl</span> --no-proxy http://localhost:8080/party
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;ID&quot;</span>:3,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;ID&quot;</span>:6,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;リザードン&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;ID&quot;</span>:9,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;カメックス&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
$ <span class="token function">curl</span> --no-proxy http://localhost:8080/party/0
<span class="token punctuation">{</span><span class="token string">&quot;ID&quot;</span>:3,<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;フシギバナ&quot;</span><span class="token punctuation">}</span>
$ <span class="token function">curl</span> --no-proxy http://localhost:8080/party/0/move
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;つるのむち&quot;</span>,<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;くさ&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div></div> <p>HTTPサーバを起動しているほうのプロセスを終了するためにはCtrl-Cなどで終了を伝えましょう。</p> <h3 id="_5-2-解説"><a href="#_5-2-解説" class="header-anchor">#</a> 5.2. 解説</h3> <h4 id="_5-2-1-httpハンドラの登録"><a href="#_5-2-1-httpハンドラの登録" class="header-anchor">#</a> 5.2.1. HTTPハンドラの登録</h4> <div class="language-go extra-class"><pre class="language-go"><code>	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
</code></pre></div><p><a href="https://golang.org/pkg/net/http/#HandleFunc" target="_blank" rel="noopener noreferrer"><code>http.HandleFunc()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>は第1引数のURLパスへのアクセスされたときに第2引数の関数に処理を受け渡すように登録するための関数です。</p> <p>今回は<code>/</code>を登録しているので、全てのアクセスが<code>router()</code>関数に飛ぶことになります。</p> <div class="custom-block tip"><p class="custom-block-title">ハンドラ? ルータ? コントローラ?</p> <p>特定のURLパスへのアクセスに対して実際に処理をするための関数の呼び方は様々あります。 <br>
例に挙げた単語は微妙にニュアンスが違うことがあります。</p> <p>HTTPリクエストをそのまま扱う処理のことをハンドラとかコントローラとか呼びます。 <br>
RailsのようなMVCフレームワークではコントローラと呼ぶことが多いです。 \</p> <p>URLパス毎にハンドラに処理を渡すためのハンドラを特にルータと呼ぶことが多いです。 <br>
Railsだと<code>routes.rb</code>、Djangoだと<code>urls.py</code>に対応するものです。 <br>
Goではマルチプレクサとも呼びます。</p></div> <h4 id="_5-2-2-httpサーバの起動"><a href="#_5-2-2-httpサーバの起動" class="header-anchor">#</a> 5.2.2. HTTPサーバの起動</h4> <p>ハンドラの処理内容を見る前にHTTPサーバの起動部分を見てみましょう。</p> <div class="language-go extra-class"><pre class="language-go"><code>	err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://golang.org/pkg/net/http/#ListenAndServe" target="_blank" rel="noopener noreferrer"><code>http.ListenAndServe()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>は第1引数のURLでHTTPリクエストを待ち受ける関数です。 <br>
この関数はCtrl-Cなりで強制終了するまで実行され続けます。</p> <p>何かしらの理由で終了すると<code>error</code>型の値が返ってくるので、4章で説明した通りにエラー処理しています。</p> <p>Goはこれを書くために生まれた言語と言っても過言ではなく、実際何もしなくていいHTTPサーバであればハンドラの登録も不要であり、本質的に必要な行はこの1行だけとなります。</p> <p><code>ListenAndServe()</code>の第2引数も実はハンドラを登録するために用意されているのですが、<code>nil</code>を指定するとデフォルトで用意されているハンドラ(マルチプレクサ)を勝手に使ってくれます。 <br>
さらに実はですが、このデフォルトのマルチプレクサに対してハンドラを登録するための関数が<code>http.HandleFunc()</code>だったりします。</p> <h4 id="_5-2-3-ルータの処理"><a href="#_5-2-3-ルータの処理" class="header-anchor">#</a> 5.2.3. ルータの処理</h4> <p><code>router()</code>関数の処理を見ていきましょう。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">router</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> path<span class="token punctuation">.</span><span class="token function">Clean</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">:=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getParty</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party/[0-5]&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getPokemon</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	ok<span class="token punctuation">,</span> err <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token string">&quot;/party/[0-5]/move&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
		<span class="token function">getMove</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://golang.org/pkg/path/#Clean" target="_blank" rel="noopener noreferrer"><code>path.Clean()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>は変なURLパス(<code>//party/../party</code>とか)が指定されていた場合を想定して、冗長な表現を消すための関数です。 <br>
この後の処理でURLパスを扱いやすくするために使っています。</p> <p><a href="https://golang.org/pkg/path/#Match" target="_blank" rel="noopener noreferrer"><code>path.Match()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>は指定したパターンに文字列がマッチしていれば<code>true</code>を返してくれる関数です。 <br>
今回のサーバはURLパスに応じて処理を変更したいので、URLパスを判断するために使っています。</p> <p>今回は以下のAPIを作成しています。</p> <ul><li><code>/party</code>: パーティ一覧(<code>getParty()</code>)</li> <li><code>/party/&lt;index&gt;</code>: パーティ内のポケモンの取得(<code>getPokemon()</code>)</li> <li><code>/party/&lt;index&gt;/move</code>: パーティ内のポケモンのわざ一覧(<code>getMove()</code>)</li></ul> <p>なお<code>renderError()</code>関数は第3引数のステータスコードでユーザにエラーを返す処理です。 <br>
ただステータスコードを返すだけであれば関数に分けるほどもないのですが、今回はREST APIサーバなのでエラーもJSONで返したかったため、そのための処理を分離しています。 <br>
今回は解説しませんが、興味があれば中を読んでみてください。</p> <h4 id="_5-2-4-ハンドラ内の処理"><a href="#_5-2-4-ハンドラ内の処理" class="header-anchor">#</a> 5.2.4. ハンドラ内の処理</h4> <h5 id="_5-2-4-1-getparty"><a href="#_5-2-4-1-getparty" class="header-anchor">#</a> 5.2.4.1. <code>getParty()</code></h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">getParty</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> party<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>renderResponse()</code>関数は第2引数の値をJSON形式でユーザに返すための関数です。 <br>
JSONへの変換やヘッダの設定など雑多な処理を意識しないために別関数に括り出しています。 <br>
今回は解説しませんが、興味があれば中を読んでみてください。</p> <h5 id="_5-2-4-2-getpokemon"><a href="#_5-2-4-2-getpokemon" class="header-anchor">#</a> 5.2.4.2. <code>getPokemon()</code></h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">getPokemon</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	indexParam <span class="token operator">:=</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
	index<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>indexParam<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> index <span class="token operator">&gt;</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> party<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>URLパスは<code>/party/0</code>のような形をしているはずなので、そこからまず<code>0</code>という数値を取り出す必要があります。 <br>
そのため<a href="https://golang.org/pkg/strings/#Split" target="_blank" rel="noopener noreferrer"><code>strings.Split()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>で<code>/</code>区切りで文字列を分割しています。</p> <p>先の例では<code>p</code>は<code>[&quot;&quot;, &quot;party&quot;, &quot;0&quot;]</code>という形に分割(最初の<code>/</code>も分割されることに注意)されているはずなので、その長さをチェックしてから<code>p[2]</code>を取り出せば<code>&quot;0&quot;</code>という文字列(まだ数値ではない)が取得できます。</p> <p>あとは<a href="https://golang.org/pkg/strconv/#Atoi" target="_blank" rel="noopener noreferrer"><code>strconv.Atoi()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>で<code>int</code>型に変換してやればURLパスの解釈は完了です。</p> <p>細かいチェックとして、<code>party</code>変数の長さを越えた値を指定された場合は<code>party</code>変数の長さで頭打ちさせておいて、<code>party[index]</code>を返してやれば終わりです。</p> <h5 id="_5-2-4-3-getmove"><a href="#_5-2-4-3-getmove" class="header-anchor">#</a> 5.2.4.3. <code>getMove()</code></h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">getMove</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	p <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;invalid path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	indexParam <span class="token operator">:=</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
	index<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>indexParam<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> index <span class="token operator">&gt;</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		index <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>party<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	poke <span class="token operator">:=</span> party<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

	moves<span class="token punctuation">,</span> err <span class="token operator">:=</span> poke<span class="token punctuation">.</span><span class="token function">Moves</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">renderError</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">renderResponse</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> moves<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前半のURLパスの解釈は<code>getPokemon()</code>の処理とほとんど同じです。</p> <p>あとは<code>Pokemon.Moves()</code>の実行結果を返してやれば終わりです。</p> <h2 id="_6-まとめ"><a href="#_6-まとめ" class="header-anchor">#</a> 6. まとめ</h2> <p>Goの概説からhello world、package分割、基本的な文法、Web APIサーバの作成までさっくり追っていきました。 <br>
今回のサンプルコードはちゃんとエラー処理まで書いており、量はさておき質としてはほぼ業務で書くコードと遜色ないものだと思います。</p> <p>とはいえ最後のサンプルについてはプロダクションとしてリリースするためには足りていない部分もあります。 <br>
具体的には</p> <ul><li>テストが無い
<ul><li><a href="https://golang.org/pkg/testing/" target="_blank" rel="noopener noreferrer"><code>testing</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>パッケージを使ったテストを書く</li> <li>GoではTDT(Table Driven Test)が好まれる</li></ul></li> <li>HTTPメソッドを判断していないので、実はPOSTでも同じ応答が返ってくる
<ul><li>小規模なままであればシンプルに<code>router()</code>でちゃんと<code>r.Method</code>に応じた分岐を書くとよい</li> <li><a href="https://github.com/go-chi/chi" target="_blank" rel="noopener noreferrer">go-chi/chi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>のようなルータを担うパッケージもあるので利用するのもよい</li></ul></li> <li>もし更新APIを実装したとしても、データがメモリ上にしかないので再起動の度にデータが初期状態に戻ってしまう
<ul><li>データベースを使い永続化したい</li> <li><a href="https://golang.org/pkg/database/sql/" target="_blank" rel="noopener noreferrer"><code>database/sql</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>パッケージを使えばデータベースと接続できる</li></ul></li> <li>ログを出力したい
<ul><li><a href="https://golang.org/pkg/log/" target="_blank" rel="noopener noreferrer"><code>log</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>パッケージを使えばログが出せる</li></ul></li></ul> <p>のようなことを解決してみるのはよい経験になるでしょう。</p> <p>もちろん、やっている内に発生するであろう疑問などは私に聞いていただければ答えます。</p> <p>その他外部のコミュニティから情報を得るのも良いでしょう。</p> <ul><li>Gophers slackの#japanチャンネル
<ul><li>世界中のGopherが集うslack、その中の#japanに日本人Gopherが住んでいます</li></ul></li> <li><a href="https://vim-jp.org/docs/chat.html" target="_blank" rel="noopener noreferrer">vim-jp slackの#lang-goチャンネル<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>Vimコミュニティのslackですが、何故かGopher slackの#japanより活発</li> <li>普通にEmacs使いの人もいるので、お使いのエディタに依らずどうぞ</li> <li><a href="https://mattn.kaoriya.net/etc/gde.htm" target="_blank" rel="noopener noreferrer">こういう人<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>がいたりします</li></ul></li> <li><a href="https://gocon.jp/" target="_blank" rel="noopener noreferrer">Go Conference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>今年はこんな状態なので開催されてませんが、例年は半年毎に開催されるGoコミュニティによるカンファレンス</li></ul></li></ul> <p>というわけで、Goやっていきましょう</p> <div><hr> <span>CC BY-SA Licensed | Copyright (c) 2020, Internet Initiative Japan Inc.</span></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/iij/bootcamp/edit/master/src/server-app/go/README.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/10/2021, 4:48:56 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/bootcamp/assets/js/app.7dbfbf9e.js" defer></script><script src="/bootcamp/assets/js/2.190e1afb.js" defer></script><script src="/bootcamp/assets/js/33.decc7469.js" defer></script><script src="/bootcamp/assets/js/9.58ca0658.js" defer></script><script src="/bootcamp/assets/js/8.5492b9a0.js" defer></script>
  </body>
</html>
