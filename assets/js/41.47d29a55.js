(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{499:function(t,a,s){"use strict";s.r(a);var n=s(45),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"fastapi-を使ったweb-アプリケーションサーバ作り"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fastapi-を使ったweb-アプリケーションサーバ作り"}},[t._v("#")]),t._v(" FastAPI を使ったWeb アプリケーションサーバ作り")]),t._v(" "),s("h2",{attrs:{id:"_0-この講義について"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-この講義について"}},[t._v("#")]),t._v(" 0. この講義について")]),t._v(" "),s("p",[t._v("この講義ではハンズオン形式でFastAPIについて学びます。\n講義を受けるにあたり、事前に環境準備が必要です。\n可能であれば教材のREADMEに従い、講義当日までに2.1、もしくは\n以下のことが可能な環境を整えてください。")]),t._v(" "),s("h3",{attrs:{id:"_0-1-fastapi開発環境を整える意義"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-1-fastapi開発環境を整える意義"}},[t._v("#")]),t._v(" 0.1. FastAPI開発環境を整える意義")]),t._v(" "),s("p",[t._v("FastAPIによる開発をスムーズに行う為には開発環境の構築は欠かせません。\nもちろん従来通りVim, Emacsといったエディタでコードを書くことも可能ですが\nFastAPIはvscodeやPyCharm等に代表されるIDEが持つ補完、Lint機能活用することで\n安全で堅牢なコードを書き上げることを強く意識しています。\n従って、FastAPIによるWebアプリケーションを作る際には\n補完機能が十分に働くIDEを活用して開発を行うほうが好ましいと言えるでしょう。")]),t._v(" "),s("p",[t._v("PythonのバージョンもFastAPIはPython3.6以上に対応、とされていますが\nPythonの型は3.8、および3.9で大幅な追加がなされているため、\n最低でも3.8以上の環境下で開発することが好ましいです。")]),t._v(" "),s("h3",{attrs:{id:"_0-2-python3-9-vscode-環境を作る"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-2-python3-9-vscode-環境を作る"}},[t._v("#")]),t._v(" 0.2. Python3.9 + vscode 環境を作る")]),t._v(" "),s("p",[t._v("すでにPython3.8 + IDE 環境を構築済みの方は本項を読み飛ばして構いませんが\nここではWindowsユーザ向けに環境作りの一例を示しておきます。\npython3.8以上の環境下でvscodeが使えるようにしてください。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.docker.com/products/docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker for Desktop"),s("OutboundLink")],1),t._v("を用いて\nPython3.9環境を作り、そこで開発を行います。\n下記を参考に Remote-Container (docker + vscode)で環境を作ってみてください。\n英語表記のため、よく分からない場合は 0.2.1 の項の通り実施してみましょう。")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/microsoft/vscode-remote-try-python",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/microsoft/vscode-remote-try-python"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("bashを起動し、以下のように表示されればOKです。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("vscode ➜ /workspaces/vscode-remote-try-python "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ python --version\nPython "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.9")]),t._v(".6\n")])])]),s("h4",{attrs:{id:"_0-2-1-作業例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-2-1-作業例"}},[t._v("#")]),t._v(" 0.2.1 作業例")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("F1")]),t._v(" を押す")]),t._v(" "),s("li",[s("code",[t._v("Remote-Containers: Try a Development Container Sample...")]),t._v(" を選ぶ")]),t._v(" "),s("li",[s("code",[t._v("Python")]),t._v("を選ぶ")]),t._v(" "),s("li",[t._v("待つ")]),t._v(" "),s("li",[t._v("Terminalタブを表示した際に0.2 のbashプロンプトが出ていればOK")])]),t._v(" "),s("p",[t._v("Pythonを選ぶ、の際の選択イメージは以下のページのような状況です(URLではNodeを選択しています)\n"),s("a",{attrs:{href:"https://code.visualstudio.com/docs/remote/containers#_getting-started",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://code.visualstudio.com/docs/remote/containers#_getting-started"),s("OutboundLink")],1)]),t._v(" "),s("h5",{attrs:{id:"ハマりポイント"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ハマりポイント"}},[t._v("#")]),t._v(" ハマりポイント")]),t._v(" "),s("ul",[s("li",[t._v("Docker が起動していない\n"),s("ul",[s("li",[t._v("認識できていないだけの場合も多いが、とりあえずDockerを再起動してみてください")]),t._v(" "),s("li",[t._v("Windowsであればタスクバーの右下。クジラアイコンを右クリック - Restart")])])]),t._v(" "),s("li",[t._v("イメージがダウンロードできていない\n"),s("ul",[s("li",[t._v("プロキシに阻まれている\n"),s("ul",[s("li",[t._v("Terminal等にConnection Timeout等が出ていればまさしくそれ。")]),t._v(" "),s("li",[t._v("トラブルシューティングを元にproxy設定を入れる")])])])])])]),t._v(" "),s("h2",{attrs:{id:"_1-fastapiとは"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-fastapiとは"}},[t._v("#")]),t._v(" 1. FastAPIとは")]),t._v(" "),s("p",[t._v("公式ドキュメント: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("FastAPI は、Pythonの標準である型ヒントに基づいてPython 3.6 以降でAPI を構築するための、\nモダンで、高速(高パフォーマンス)な、Web フレームワークです。\n")])])]),s("p",[t._v("FastAPIとは、Python、特に3.5から導入されたtypehintと、ASGIサーバへの対応を強く意識したWebフレームワークです。")]),t._v(" "),s("p",[t._v("Pythonは元来、動的型言語、と言うことで長らく型を意識すること無くコードが書かれていましたが\n3.5以降、急速に型を意識するようになっています。\nFastAPIはその流れにいち早く対応し、"),s("code",[t._v("高速")]),t._v("、"),s("code",[t._v("堅牢")]),t._v("を実現するために最小限の構造とtypehintを元に\nvalidationを強く意識した構造になっています。")]),t._v(" "),s("h3",{attrs:{id:"_3-fastapiのインストール・動作確認"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-fastapiのインストール・動作確認"}},[t._v("#")]),t._v(" 3. FastAPIのインストール・動作確認")]),t._v(" "),s("p",[t._v("FastAPIによるWebApp開発環境の下地が揃ったらFastAPIをインストールします。\n"),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/",target:"_blank",rel:"noopener noreferrer"}},[t._v("公式ドキュメント"),s("OutboundLink")],1),t._v("では以下のように記載されていますので\nまずはその通りインストールしてみましょう。")]),t._v(" "),s("h4",{attrs:{id:"_3-1-fastapi-uvicornのインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-fastapi-uvicornのインストール"}},[t._v("#")]),t._v(" 3.1 FastAPI/uvicornのインストール")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" pip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" fastapi\n pip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" uvocorn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("standard"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("NOTE: 2.1で記載した方法でPython-sampleコンテナを利用している場合は下記のWARNINGが出ます。その場合は"),s("code",[t._v("pip3 install uvicorn[standard] --upgrade")]),t._v(" として、既存のパッケージをアップグレードしてください")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("WARNING: Target directory /usr/local/pip-global/click-8.0.1.dist-info already exists. Specify --upgrade to force replacement.\nWARNING: Target directory /usr/local/pip-global/click already exists. Specify --upgrade to force replacement.\nWARNING: Target directory /usr/local/pip-global/bin already exists. Specify --upgrade to force replacement.\n")])])]),s("h4",{attrs:{id:"_3-2-動作確認用アプリの作成、起動"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-動作確認用アプリの作成、起動"}},[t._v("#")]),t._v(" 3.2 動作確認用アプリの作成、起動")]),t._v(" "),s("p",[t._v("インストールが完了したら次にFastAPI用のコードを作成します。\n公式ドキュメントの通りmain.pyというファイルを作成し、以下のようにコードを書いてみましょう。\nよく分からない方は"),s("a",{attrs:{href:"https://github.com/ainamori/bootcamp/tree/2021/server-app/fastapi/src/server-app/fastapi/sample",target:"_blank",rel:"noopener noreferrer"}},[t._v("sample"),s("OutboundLink")],1),t._v("ディレクトリに以下を記載したファイルがあるので参考にしてください。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" fastapi "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" FastAPI\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FastAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"World"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("main.pyファイルが作成できたら起動してみましょう。\n起動には先ほどインストールした"),s("code",[t._v("uvicorn")]),t._v("(コマンド)に"),s("code",[t._v("main:app")]),t._v("を引数として渡して実行します。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" uvicorn main:app\n")])])]),s("p",[t._v("正常に起動した場合、そのまま以下のように出力され "),s("code",[t._v("http://127.0.0.1:8000")]),t._v("と表示されます。\nここまでくれば無事に起動しています。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("INFO:     Started server process [1990921]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n")])])]),s("p",[t._v("なお、上記のコマンドではターミナルがそのままフォアグラウンドで動き続けてしまうため、\n動作確認は別のターミナルを起動する必要があります。\n別ターミナルを起動したら、curlコマンドでアクセスしてみましょう。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 http://127.0.0.1:8000\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"World"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("main.pyに記載した Hello Worldの出力と同時にFastAPIのコンソールにもアクセスログが出力されます。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("INFO:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:60100 - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET / HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n")])])]),s("p",[t._v("ひとまずここまでできればFastAPIの実行環境としては十分になりました。\n終了には"),s("code",[t._v("Ctrl+c")]),t._v("で止めてください。")]),t._v(" "),s("h4",{attrs:{id:"_3-3-ドキュメントの確認"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-ドキュメントの確認"}},[t._v("#")]),t._v(" 3.3 ドキュメントの確認")]),t._v(" "),s("p",[t._v("FastAPIには"),s("code",[t._v("swagger-ui")]),t._v("が含まれており、デフォルトの動作としてOpenAPIドキュメントを生成します。\nこのOpenAPIのドキュメントパスは "),s("code",[t._v("/docs")]),t._v("になっており起動と同時にアクセスが可能です。\nそれでは先ほどのmain.pyを再び起動しアクセスしてみましょう。\n環境によってはListenアドレスが"),s("code",[t._v("127.0.0.1")]),t._v("のみでは都合が悪いので"),s("code",[t._v("--host 0.0.0.0")]),t._v("を追加します。\nそうすることにより 0.0.0.0:8000　でListenするようになるため、外部からのアクセスも可能になります")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" uvicorn main:app --host "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 --reload\n\nINFO:     Started server process "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1990921")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nINFO:     Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:8000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Press CTRL+C to quit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("起動したら "),s("code",[t._v("http://127.0.0.1:8000/docs/")]),t._v("にアクセスしてみましょう。"),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/first-steps/#api",target:"_blank",rel:"noopener noreferrer"}},[t._v("ここ"),s("OutboundLink")],1),t._v("で表示されているようなWeb画面にアクセスできれば正常です。\nここではFastAPIに定義した全てのパスについて入出力情報が記載されるだけで無く、swagger-clientも内包されているため、そのままテストを行うことも可能です。")]),t._v(" "),s("h5",{attrs:{id:"解説"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解説"}},[t._v("#")]),t._v(" 解説")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"http://main.py",target:"_blank",rel:"noopener noreferrer"}},[t._v("main.py"),s("OutboundLink")],1),t._v(" "),s("ul",[s("li",[s("code",[t._v("from fastapi import FastAPI")]),t._v(": FastAPIモジュールのロード。Pythonではお馴染み")]),t._v(" "),s("li",[s("code",[t._v("app = FastAPI()")]),t._v(": appという名前でFastAPIをインスタンス化。後述のuvicornはこれを実行しているインスタンス化の際にいくつかオプションを渡すことができる")]),t._v(" "),s("li",[s("code",[t._v('@app.get("/")')]),t._v(": flask等でもお馴染みの記法。 "),s("code",[t._v("/")]),t._v(" に "),s("code",[t._v("GET")]),t._v(" メソッドが来たときの振る舞いを記載する")])])]),t._v(" "),s("li",[t._v("uvicorn main:appの示すもの\n"),s("ul",[s("li",[s("code",[t._v("main")]),t._v(' main.pyファイル (Python "module")。Pythonではディレクトリを'),s("code",[t._v(".")]),t._v("で表すため sample/main.pyの場合、 "),s("code",[t._v("sample.main")]),t._v(" になる")]),t._v(" "),s("li",[s("code",[t._v("app")]),t._v(" main.py内部で作られるobject（app = FastAPI()のように記述される）。")]),t._v(" "),s("li",[s("code",[t._v("--reload")]),t._v(": コードの変更時にサーバーを再起動させる。開発用。")])])])]),t._v(" "),s("h3",{attrs:{id:"_4-fastapiでwebアプリケーションを作る"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-fastapiでwebアプリケーションを作る"}},[t._v("#")]),t._v(" 4 FastAPIでWebアプリケーションを作る")]),t._v(" "),s("p",[t._v("それではいよいよ本格的にWebアプリケーションの開発を行っていきます。\nFastAPIに限らずWebアプリケーションを作る以上、パラメータもなしにただの静的コンテンツを返すだけでは意味が無いので以下の項目をそれぞれ実装してみます。")]),t._v(" "),s("h4",{attrs:{id:"_4-1-パスパラメータ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-パスパラメータ"}},[t._v("#")]),t._v(" 4.1 パスパラメータ")]),t._v(" "),s("p",[t._v("Webアプリケーションを作る際にパス情報をパラメータとして何らかの処理をしたい場合を考えます。\nFastAPIでは、Pythonのformat文字列と同様のシンタックスで"),s("code",[t._v("パスパラメータ")]),t._v("や"),s("code",[t._v("パス変数")]),t._v("を宣言できます。")]),t._v(" "),s("p",[t._v("先ほどのmain.pyにパスパラメータを扱うメソッドを定義してみましょう。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/items/{item_id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" item_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("追記できたら3. と同様に起動してパスパラメータを与えてアクセスしてみましょう。")]),t._v(" "),s("h5",{attrs:{id:"解説-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解説-2"}},[t._v("#")]),t._v(" 解説")]),t._v(" "),s("ul",[s("li",[s("code",[t._v('@app.get("/items/{item_id}")')]),t._v(": URLパスの宣言\n"),s("ul",[s("li",[t._v("パスパラメータ item_id の値は、引数 item_id として関数に渡されます。")])])])]),t._v(" "),s("details",[s("summary",[t._v(" 実行例")]),t._v(" "),s("ul",[s("li",[t._v("FastAPI起動・コンソール出力")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("uvicorn main:app\n\nINFO:     Started server process "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1993570")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nINFO:     Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Press CTRL+C to quit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nINFO:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:60230 - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /items/hoge HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n")])])]),s("ul",[s("li",[t._v("curl実行、及び結果")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy localhost http://localhost:8000/items/hoge\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_id"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hoge"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/path-params/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/tutorial/path-params/"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_4-2-クエリパラメータ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-クエリパラメータ"}},[t._v("#")]),t._v(" 4.2 クエリパラメータ")]),t._v(" "),s("p",[t._v('パスパラメータが実現できたら次はクエリパラメータの操作を作ってみましょう。\nFastAPIでは関数の引数を宣言した時にパスパラメータではない関数パラメータを宣言すると、それらは自動的に "クエリ" パラメータとして解釈されます。')]),t._v(" "),s("p",[t._v("それでは先ほどに続きmain.pyにクエリパラメータを扱うメソッドを定義してみましょう。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("fake_items_db "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Baz"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/items/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_query_item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("skip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" limit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""4.2 クエリパラメータ"""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" fake_items_db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("skip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" skip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" limit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("追記できたら再び起動してクエリパラメータを与えてアクセスしてみましょう。")]),t._v(" "),s("h5",{attrs:{id:"解説-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解説-3"}},[t._v("#")]),t._v(" 解説")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("fake_items_db")]),t._v(": クエリパラメータに応じて返答する数を変えるためのデータリスト")]),t._v(" "),s("li",[s("code",[t._v("def read_query_item(skip: int = 0, limit: int = 10):")]),t._v(": クエリパラメータ向けのメソッド追加\n"),s("ul",[s("li",[t._v("クエリ名"),s("code",[t._v("skip")]),t._v(", "),s("code",[t._v("limit")]),t._v("を宣言。それぞれ int型で定義しているため、 "),s("code",[t._v("skip=hoge")]),t._v(" みたいな形はエラーになる")])])])]),t._v(" "),s("details",[s("summary",[t._v(" 実行例")]),t._v(" "),s("ul",[s("li",[t._v("FastAPI起動・コンソール出力")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("uvicorn main:app\n\nINFO:     Started server process "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1993570")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nINFO:     Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Press CTRL+C to quit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nINFO:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:60488 - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /items/?skip=0&limit=1 HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\nINFO:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:60514 - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /items/?skip=0&limit=2 HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n")])])]),s("ul",[s("li",[t._v("curl実行、及び結果")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy localhost "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000/items/?skip=0&limit=1"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy localhost "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000/items/?skip=0&limit=2"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item_name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/query-params/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/tutorial/query-params/"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_4-3-リクエストボディ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-リクエストボディ"}},[t._v("#")]),t._v(" 4.3 リクエストボディ")]),t._v(" "),s("p",[t._v("パスパラメータ・クエリパラメータが実現できたら次はリクエストボディを扱ってみましょう。\nリクエストボディはクライアントからAPIにデータを送信する時に使います。")]),t._v(" "),s("p",[t._v("それでは4.1、4.2と同様にmain.pyにリクエストボディを扱うメソッドを追加してみましょう。")]),t._v(" "),s("h5",{attrs:{id:"_4-3-1-pydantic-によるモデルの定義"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-pydantic-によるモデルの定義"}},[t._v("#")]),t._v(" 4.3.1 Pydantic によるモデルの定義")]),t._v(" "),s("p",[t._v("FastAPIでは型を宣言することで入出力のvaidation checkを行っていることは冒頭で述べたとおりです。\n4.1のパスパラメータの項では型宣言を行いませんでしたが4.2のクエリパラメータの項では型を定義しチェックするようにしています。\nでは、リクエストボディの場合はどうすれば良いのでしょうか？\nそれに対する解が"),s("a",{attrs:{href:"https://pydantic-docs.helpmanual.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pydantic"),s("OutboundLink")],1),t._v("です。")]),t._v(" "),s("p",[t._v("従ってまずは期待するリクエストボディの型を定義することから始めます。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pydantic "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BaseModel\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" typing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Optional\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("BaseModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),t._v("\n    description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Optional"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n    price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v("\n    tax"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Optional"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n")])])]),s("h5",{attrs:{id:"解説-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解説-4"}},[t._v("#")]),t._v(" 解説")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("from pydantic import BaseModel")]),t._v(": pydantic のモジュールロード。基本的にはBaseModelを使う")]),t._v(" "),s("li",[s("code",[t._v("from typing import Optional")]),t._v(": Python typehintのロード")]),t._v(" "),s("li",[s("code",[t._v("class Item(BaseModel):")]),t._v(": リクエストボディの型を定義するクラス pydanticのBaseModelを継承")])]),t._v(" "),s("h5",{attrs:{id:"_4-3-2-リクエストボディを処理するメソッドの定義"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-リクエストボディを処理するメソッドの定義"}},[t._v("#")]),t._v(" 4.3.2 リクエストボディを処理するメソッドの定義")]),t._v(" "),s("p",[t._v("リクエストボディの型定義が済んだらこの型を用いてPOSTを受け付けるメソッドを定義します。\n本来であればPOSTされたデータをどこかに格納し、GETメソッドなどで中身を取り出すのですが\n今回はそういったデータストアを用いていないため、リクエストボディで受け付けた内容をそのまま返すものとします。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/items/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""4.3 リクエストボディ"""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" item\n")])])]),s("p",[t._v("追記できたら再び起動してリクエストボディを与えてアクセスしてみましょう。")]),t._v(" "),s("details",[s("summary",[t._v(" 実行例")]),t._v(" "),s("ul",[s("li",[t._v("FastAPI起動・コンソール出力")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("uvicorn main:app\n\nINFO:     Started server process "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1993570")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nINFO:     Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://127.0.0.1:8000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Press CTRL+C to quit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nINFO:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:60644 - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST /items/ HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n")])])]),s("ul",[s("li",[t._v("curl実行、及び結果")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy localhost -X "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:8000/items/'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -H "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -H "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n  "name": "string",\n  "description": "string",\n  "price": 0,\n  "tax": 0\n}\'')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"price"')]),t._v(":0.0,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tax"')]),t._v(":0.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/body/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/tutorial/body/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_5-発展学習"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-発展学習"}},[t._v("#")]),t._v(" 5. 発展学習")]),t._v(" "),s("p",[t._v("さて、ここまででFastAPIを用いて作るWebアプリケーションの基本的な部分は学びました。\nしかし、本格的に開発を行うのであれば抑えておきたいポイントがいくつかありますので\nそれらの一例を記載しておきます。")]),t._v(" "),s("h4",{attrs:{id:"_5-1-gunicornの利用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-gunicornの利用"}},[t._v("#")]),t._v(" 5.1 Gunicornの利用")]),t._v(" "),s("p",[t._v("これまでFastAPIの起動には"),s("code",[t._v("uvicorn")]),t._v("を使ってきましたが\nuvicornのサイトにも記載されているとおり、Gunicornを使う方がより好ましいといえます。\n事実、uvicornのサイトでもGunicornの利用を推奨しています。\n"),s("a",{attrs:{href:"https://www.uvicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.uvicorn.org/"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Gunicorn is a mature, fully featured server and process manager.\n")])])]),s("p",[t._v("ではGunicornをインストールし、起動方法を変更してみましょう。\nNOTE: 必要に応じて "),s("code",[t._v("--upgrade")]),t._v("オプションを追加してください")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ pip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" fastapi Gunicorn uvicorn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("standard"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("GunicornがインストールできたらGunicornを使って先ほどのアプリケーションを起動してみましょう。\nこちらも以下の通り実行するとuvicornで起動した時と同様にフォアグラウンドで動作する為、確認の際は別ターミナルを起動します。\nまた、終了も同じように"),s("code",[t._v("Ctrl+c")]),t._v("で終了してください。")]),t._v(" "),s("details",[s("summary",[t._v(" 実行例")]),t._v(" "),s("ul",[s("li",[t._v("FastAPI起動・コンソール出力")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("gunicorn -k uvicorn.workers.UvicornWorker main:app\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998398")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting gunicorn "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.1")]),t._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998398")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listening at: http://127.0.0.1:8000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998398")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998398")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using worker: uvicorn.workers.UvicornWorker\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Booting worker with pid: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Started server process "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" application startup.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-07-07 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":22:57 +0900"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1998400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Application startup complete.\n")])])]),s("ul",[s("li",[t._v("curl実行、及び結果")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --noproxy localhost "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:8000"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"World"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://zenn.dev/ainamori/articles/76990129cac97de0e30b",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zenn.dev/ainamori/articles/76990129cac97de0e30b"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_5-2-非同期処理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-非同期処理"}},[t._v("#")]),t._v(" 5.2 非同期処理")]),t._v(" "),s("p",[t._v("起動をGunicornに変更できたら次はASGI対応のWebアプリケーションを作ってみましょう。\n実はuvicornでもASGI対応のWebアプリケーション作成は可能なのですが、前述の通りGunicornを使え、と言うのが\n公式の推奨という事もあり、まずはGunicornの活用を先に行っています。")]),t._v(" "),s("p",[t._v("また、ASGIとはWSGIと呼ばれるWebサーバとWebアプリケーションを接続するための、\n標準化されたインタフェース定義の精神的(*)な後継仕様です。\nASGIとは 非同期サーバゲートウェイインタフェース(Asynchronous Server Gateway Interface)の名の通り\nasyncioを介して非同期で動作するよう設計されています。\nFastAPIでASGI対応のアプリケーションを作るためにはFastAPIのBackgroundTaskを使います。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" fastapi "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BackgroundTasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FastAPI\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sleep\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print_wait_time")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Wait ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' second & print!"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/{count}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asgi_task")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" background_tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" BackgroundTasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    background_tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("print_wait_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"See the console log for wait time."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/background-tasks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/tutorial/background-tasks/"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("*)ASGIの公式ドキュメントにもspiritualと書いてあり、「精神的な」後継である事が明記されている。")]),t._v(" "),s("h4",{attrs:{id:"_5-3-plaintext-response"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-plaintext-response"}},[t._v("#")]),t._v(" 5.3 PlainText Response")]),t._v(" "),s("p",[t._v('FastAPIはWebアプリケーション開発用フレームワークという事もありデフォルトでは全てJSONで返す挙動となっています。\nしかし、"/"のような場所はアプリケーションが起動しているか否かといった単純な監視用に定義するようなことがあり、そういうときには単純な平文を返したいと思うことでしょう。\nそのような時にはResponse_classを変更する事でPlain Textを返すことができます。')]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" fastapi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responses "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PlainTextResponse\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/plaintext/ok"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response_class"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PlainTextResponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("return_plain_text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OK"')]),t._v("\n")])])]),s("h4",{attrs:{id:"_5-4-エラーハンドリング"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-エラーハンドリング"}},[t._v("#")]),t._v(" 5.4 エラーハンドリング")]),t._v(" "),s("p",[t._v("FastAPIは存在しない（未定義）のURLパスにアクセスすると404を返す、といった基本的な動作は備えています。\nしかしながら受け付けたURLに対し、なんらかの処理を行い、その結果に応じてレスポンスコードを変化させたい、と言った時はどのようにすれば良いのでしょうか。")]),t._v(" "),s("p",[t._v("FastAPIにはHTTPExceptionが含まれている為、それを呼び出すことで任意のレスポンスコードを返すことができます。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" fastapi "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" FastAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HTTPException\n\nitems "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hoge"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is Hoge"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/error/{item_id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_item_with_error_handling")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" item_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" HTTPException"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("status_code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Item not found"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("item_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("参考: "),s("a",{attrs:{href:"https://fastapi.tiangolo.com/ja/tutorial/handling-errors/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastapi.tiangolo.com/ja/tutorial/handling-errors/"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_5-6-extra-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-extra-info"}},[t._v("#")]),t._v(" 5.6 Extra Info")]),t._v(" "),s("p",[t._v("FastAPIは起動時に様々な情報を追加することができます。\n下記に一例を示しますので実際に設定を行ってみましょう。\nどのような違いが出るか試してみてください。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FastAPI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IIJ Bootcamp HandsOn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    description"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IIJ Bootcamp Web Application by FastAPI."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_6-まとめ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-まとめ"}},[t._v("#")]),t._v(" 6. まとめ")]),t._v(" "),s("p",[t._v("今回は、FastAPIを使ってWebアプリケーションを作ってみました。\nFastAPIは決して大規模なWebアプリケーションを作るために作られた物ではありませんが、作り方次第で多くの処理を任せることができます。")]),t._v(" "),s("p",[t._v("BootCampではあくまでチュートリアルのような形で作成したため、全てを一つのmain.pyに記載しましたが開発をスムーズに行う上ではpydanticで定義するモデルファイルは分ける。エンドポイントも階層化に合わせてファイルを分ける、といったテクニックが必要になってきますのでそういった所を今後は学んでいって頂ければと思います。")]),t._v(" "),s("h4",{attrs:{id:"tips-より詳細なログ出力をしたい時は"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-より詳細なログ出力をしたい時は"}},[t._v("#")]),t._v(" Tips - より詳細なログ出力をしたい時は？")]),t._v(" "),s("p",[t._v("Webアプリケーションを開発する上で不具合を調査する上でログは大変重要です。\nここでは処理時間やリクエストをログに出力するためのTipsをご紹介します。\n先ほど示したsampleディレクトリに logging_context.py という、ログ出力のために作られたClassがあるので\nこれをimportし、LoggingContextRouteをappのrouter.route_class に指定することで詳細なログに出力されます。\nお時間があればやってみてください。")]),t._v(" "),s("ul",[s("li",[t._v("import/設定例")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" logging_context "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LoggingContextRoute\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route_class "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LoggingContextRoute\n")])])]),s("credit-footer")],1)}),[],!1,null,null,null);a.default=e.exports}}]);